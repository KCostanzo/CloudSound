<!DOCTYPE html>
<html>
<head></head>
<body>

    <!-- This is a real world example -->
    <!-- For Google Analytics, you receive a snippet of code that is supposed to go at the top of the body statement,
    it looks like this:

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-XXXXXXXX-X', 'auto');
            ga('send', 'pageview');
        </script>

    Now this will not run correctly, because you are running it in an .html page and not from a server
    but for simplicity sake, we are going to spoof it running.  It will inject the script tag below -->

    <script async="" src="https://www.google-analytics.com/analytics.js"></script>

    <!--  To call Google Analytics so that it will fire an event, you make a javascript call like this:

    window.ga('send', 'event', {eventCategory: 'exampleCategory', eventAction: 'exampleAction'});

    But also in the analytics.js script tag above, you can clearly see the async="" attribute.  That causes funky issues.  Namely,
    what if I call window.ga before it is defined?  Because of the async="" that can happen.

    The second issue is that while window.ga can be defined, it may not be fully loaded.  To check if Google Analytics
    is fully loaded you would check:
    if (window.ga.loaded) {}
    or
    if (window.ga.loaded === true) {}

    Modify this code below so
    A) When window.ga isn't loaded, we save the events that are supposed to be sent to Google Analytics
    B) When window.ga is defined and window.ga.loaded === true that the events will be sent to Google Analytics in the
    order that they were fired below (1-5).
    C) Imagine the userClicked function passing in MainCategory-4, and MainCategory-5 were never called, how do you
    still set this up so that 1-3 are fired when window.ga.loaded is finally true?

    I will indicate where to start and stop modifying code -->

    <script type="text/javascript">
        // ONLY START MODIFYING CODE BELOW THIS LINE
        let dataArr = [];

        function userClicked(eventData) {
          if (eventData) {
            dataArr.push(eventData);
          }

          if (window.ga) {
            if (window.ga.loaded) {
              while (dataArr.length > 0) {
                let currentEventData = dataArr.shift();
                console.log(currentEventData);
                window.ga('send', 'event', currentEventData);
              }
            }
          }

          if (dataArr.length > 0) {
            setTimeout(() => {
              userClicked();
            }, 1500)
          }
          //console.log(dataArr);
        };
        // DO NOT MODIFY CODE BELOW THIS LINE

        //This is the spoofed event data to pass into Google Analytics
        function eventData(num) {
            return {
                eventCategory: 'MainCategory-' + num,
                eventAction: 'User clicked'
            };
        }

        //This is the spoofed user clicking that would trigger us sending an event into Google Analytics
        userClicked(eventData(1));
        userClicked(eventData(2));
        userClicked(eventData(3));
        //We are waiting 500milliseconds to set window.ga.loaded to true
        setTimeout(function() {
            //Spoofing that loaded is true because it will never be true if you are just running a .html file
            if (window.ga) { window.ga.loaded = true;}

            //After 500 more milliseconds we are spoofing the user clicking twice more
            setTimeout(function() {
                userClicked(eventData(4));
                userClicked(eventData(5));
            }, 500);
        }, 500);

        //If you look at the spoofed data above, you will see 3 userClicked events, those are intended to come
        //before window.ga.loaded is true.  Once again Google Analytics will never load completely so the statement:
        //if (window.ga) { window.ga.loaded = true;} ensures that we are triggering the case where Google Analytics is
        //loaded after 500 milliseconds.  After 500 more milliseconds we are spoofing that the user clicked twice more.

        //The way these should be fired in Google Analytics is in the correct order, where eventCategory would be
        //MainCategory-1, then MainCategory-2, etc...

        //As a hint, to make this easier to actually imagine what Google Analytics is doing, I would encourage you to
        //comment out line 23, and define your own window.ga function that console prints the 3rd argument which
        //contains the eventCategory iteration.
    </script>
</body>
</html>
